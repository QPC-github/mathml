<!DOCTYPE HTML>
<html lang="en">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <title>Mixing Markup Languages for Mathematical Expressions</title>
      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
      <style type="text/css">

	 /** Table of Contents taken from html 5.2 spec
	 stop flicker in toc **/

	.toc a {
		/* More spacing; use padding to make it part of the click target. */
		padding-top: 0.1rem;
		/* Larger, more consistently-sized click target */
		display: block;
		/* Reverse color scheme */
		color: black;
		border-color: #3980B5;
		border-bottom-width: 3px !important;
		margin-bottom: 0px !important;
	}


.egmeta {
color:#5555AA;font-style:italic;font-family:serif;font-weight:bold;
}

div.graphic{margin-left:2em}

table.syntax {
font-size: 75%;
background-color: #DDDDDD;
border: thin  solid;
}
table.syntax td {
border: solid thin;
}
table.syntax th {
text-align: left;
}

table.attributes td { padding-left:0.5em; padding-right:0.5em; border: solid thin; }
table.attributes td.attname { white-space:nowrap; vertical-align:top;}
table.attributes td.attdesc { background-color:#F0F0FF; padding-left:2em; padding-right:2em}

th.uname {font-size: 50%; text-align:left;}
code           { font-family: monospace; }

div.constraint,
div.issue,
div.note,
div.notice     { margin-left: 2em; }

li p           { margin-top: 0.3em;
                 margin-bottom: 0.3em; }

div.exampleInner pre { margin-left: 1em;
                       margin-top: 0em; margin-bottom: 0em}
div.exampleOuter {border: 4px double gray;
                  margin: 0em; padding: 0em}
div.exampleInner { background-color: #d5dee3;
                   border-top-width: 4px;
                   border-top-style: double;
                   border-top-color: #d3d3d3;
                   border-bottom-width: 4px;
                   border-bottom-style: double;
                   border-bottom-color: #d3d3d3;
                   padding: 4px; margin: 0em }
div.exampleWrapper { margin: 4px }
div.exampleHeader { font-weight: bold;
                    margin: 4px}
a.mainindex {font-weight: bold;}
li.sitem {list-style-type: none;}

  .error { color: red }

  div.mathml-example {border:solid thin black;
              padding: 0.5em;
              margin: 0.5em 0 0.5em 0;
             }
  div.strict-mathml-example {border:solid thin black;
              padding: 0.5em;
              margin: 0.5em 0 0.5em 0;
             }
  div.strict-mathml-example h5 {
  margin-top: -0.3em;
  margin-bottom: -0.5em;}
  var.meta {background-color:green}
  var.transmeta {background-color:red}
  pre.mathml {padding: 0.5em;
              background-color: #FFFFDD;}
  pre.mathml-fragment {padding: 0.5em;
              background-color: #FFFFDD;}
  pre.strict-mathml {padding: 0.5em;
              background-color: #FFFFDD;}
  span.uname {color:#999900;font-size:75%;font-family:sans-serif;}
  .minitoc { border-style: solid;
             border-color: #0050B2; 
             border-width: 1px ;
             padding: 0.3em;}
  .attention { border-style: solid; 
               border-width: 1px ; 
               color: #5D0091;
               background: #F9F5DE; 
               border-color: red;
               margin-left: 1em;
               margin-right: 1em;
               margin-top: 0.25em;
               margin-bottom: 0.25em; }

  .attribute-Name { background: #F9F5C0; }
  .method-Name { background: #C0C0F9; }
  .IDL-definition { border-style: solid; 
               border-width: 1px ; 
               color: #001000;
               background: #E0FFE0; 
               border-color: #206020;
               margin-left: 1em;
               margin-right: 1em;
               margin-top: 0.25em;
               margin-bottom: 0.25em; }
  .baseline {vertical-align: baseline}

  #eqnoc1 {width: 10%}
  #eqnoc2 {width: 80%; text-align: center; }
  #eqnoc3 {width: 10%; text-align: right; }

div.div1 {margin-bottom: 1em;}
          
.h3style {
  text-align: left;
  font-family: sans-serif;
  font-weight: normal;
  color: #0050B2; 
  font-size: 125%;
}

  h4 { text-align: left;
       font-family: sans-serif;
       font-weight: normal;
       color: #0050B2; }
  h5 { text-align: left;
       font-family: sans-serif;
       font-weight: bold;
       color: #0050B2; } 

  th {background:  #E0FFE0;}

  p, blockquote, h4 { font-family: sans-serif; }
  dt, dd, dl, ul, li { font-family: sans-serif; }
  pre, code { font-family: monospace }

  a.termref {
  text-decoration: none;
  color: black;
  }


.mathml-render {
font-family: serif;
font-size: 130%;
border: solid 4px green;
padding-left: 1em;
padding-right: 1em;
}
</style>
      <link rel="stylesheet" type="text/css" href="https://www.w3.org/StyleSheets/TR/2016/W3C-ED.css"><script src="//www.w3.org/scripts/TR/2016/fixup.js"> </script></head>
   <body>
      
      <h1><a id="mixing"></a>5 Mixing Markup Languages for Mathematical Expressions</h1>
      <!-- TOP NAVIGATION BAR -->
      
      <nav id="toc">
         <ol class="toc">
            <li><a href="Overview.html"><span class="secno"></span> Mathematical Markup Language (MathML) Version 4.0</a></li>
            <li><a href="chapter4.html"><span class="secno">4 </span> Content Markup</a></li>
            <li><a href="chapter6.html"><span class="secno">6 </span> Interactions with the Host Environment</a></li>
            
            <li><a href="chapter5.html"><span class="secno">5 </span> Mixing Markup Languages for Mathematical Expressions</a>
               
               <ol class="toc">
                  <li><a href="chapter5.html#mixing.semantic.annotations"><span class="secno">5.1 </span> Annotation Framework</a>
                     
                     <ol class="toc">
                        <li><a href="chapter5.html#mixing.annotation.elements"><span class="secno">5.1.1 </span> Annotation elements</a>
                           </li>
                        <li><a href="chapter5.html#mixing.annotation.keys"><span class="secno">5.1.2 </span> Annotation keys</a>
                           </li>
                        <li><a href="chapter5.html#mixing.alternate.representations"><span class="secno">5.1.3 </span> Alternate representations</a>
                           </li>
                        <li><a href="chapter5.html#mixing.content.equiv"><span class="secno">5.1.4 </span> Content equivalents</a>
                           </li>
                        <li><a href="chapter5.html#mixing.annotation.references"><span class="secno">5.1.5 </span> Annotation references</a>
                           </li>
                     </ol>
                  </li>
                  <li><a href="chapter5.html#mixing.semantic.elements"><span class="secno">5.2 </span> Elements for Semantic Annotations</a>
                     
                     <ol class="toc">
                        <li><a href="chapter5.html#mixing.elements.semantics"><span class="secno">5.2.1 </span> The <code>&lt;semantics&gt;</code> element</a>
                           
                           <ol class="toc">
                              <li><a href="chapter5.html#id.5.2.1.1"><span class="secno">5.2.1.1 </span> Description</a>
                                 </li>
                              <li><a href="chapter5.html#id.5.2.1.2"><span class="secno">5.2.1.2 </span> Attributes</a>
                                 </li>
                           </ol>
                        </li>
                        <li><a href="chapter5.html#mixing.elements.annotation"><span class="secno">5.2.2 </span> The <code>&lt;annotation&gt;</code> element</a>
                           
                           <ol class="toc">
                              <li><a href="chapter5.html#id.5.2.2.1"><span class="secno">5.2.2.1 </span> Description</a>
                                 </li>
                              <li><a href="chapter5.html#id.5.2.2.2"><span class="secno">5.2.2.2 </span> Attributes</a>
                                 </li>
                           </ol>
                        </li>
                        <li><a href="chapter5.html#mixing.elements.annotation.xml"><span class="secno">5.2.3 </span> The <code>&lt;annotation-xml&gt;</code> element</a>
                           
                           <ol class="toc">
                              <li><a href="chapter5.html#id.5.2.3.1"><span class="secno">5.2.3.1 </span> Description</a>
                                 </li>
                              <li><a href="chapter5.html#id.5.2.3.2"><span class="secno">5.2.3.2 </span> Attributes</a>
                                 </li>
                              <li><a href="chapter5.html#html.annotation.xml"><span class="secno">5.2.3.3 </span> Using <code>annotation-xml</code> in HTML documents</a>
                                 </li>
                           </ol>
                        </li>
                     </ol>
                  </li>
                  <li><a href="chapter5.html#mixing.markup"><span class="secno">5.3 </span> Combining Presentation and Content Markup</a>
                     
                     <ol class="toc">
                        <li><a href="chapter5.html#mixing.pmincm"><span class="secno">5.3.1 </span> Presentation Markup in Content Markup</a>
                           </li>
                        <li><a href="chapter5.html#mixing.cminpm"><span class="secno">5.3.2 </span> Content Markup in Presentation Markup</a>
                           </li>
                     </ol>
                  </li>
                  <li><a href="chapter5.html#mixing.parallel"><span class="secno">5.4 </span> Parallel Markup</a>
                     
                     <ol class="toc">
                        <li><a href="chapter5.html#mixing.top.level"><span class="secno">5.4.1 </span> Top-level Parallel Markup</a>
                           </li>
                        <li><a href="chapter5.html#mixing.cr"><span class="secno">5.4.2 </span> Parallel Markup via Cross-References</a>
                           </li>
                     </ol>
                  </li>
               </ol>
            </li>
         </ol>
      </nav>
      
      <div class="div1">
         <p>MathML markup can be combined with other markup languages, and
            these mixing constructions are realized by the semantic annotation
            elements.  The semantic annotation elements provide an important tool
            for making associations between alternate representations of an
            expression, and for associating semantic properties and other
            attributions with a MathML expression.  These elements allow
            presentation markup and content markup to be combined in several
            different ways.  One method, known as <em>mixed markup</em>, is to
            intersperse content and presentation elements in what is essentially a
            single tree.  Another method, known as <em>parallel markup</em>,
            is to provide both explicit presentation markup and content markup in
            a pair of markup expressions, combined by a single <code>semantics</code>
            element.
            </p>
         <div class="div2">
            
            <h2><a id="mixing.semantic.annotations"></a>5.1 Annotation Framework</h2>
            <p>
               An important concern of MathML is to represent associations between
               presentation and content markup forms for an expression.  Representing
               associations between MathML expressions and data of other kinds is
               also important in many contexts.  For this reason, MathML provides a
               general framework for annotation.  A MathML expression may be
               decorated with a sequence of pairs made up of a symbol that indicates
               the kind of annotation, known as the <em>annotation key</em>, and
               associated data, known as the <em>annotation value</em>.
               </p>
            <div class="div3">
               
               <h3><a id="mixing.annotation.elements"></a>5.1.1 Annotation elements</h3>
               <p>
                  The <code>semantics</code>, <code>annotation</code>, and
                  <code>annotation-xml</code> elements are used together to represent
                  annotations in MathML.  The <code>semantics</code> element provides the
                  container for a expression and its annotations.  The
                  <code>annotation</code> element is the container for text
                  annotations, and the <code>annotation-xml</code> element is used for
                  structured
                  annotations. The <code>semantics</code> element contains the expression
                  being annotated as its first child, followed by a sequence of zero or
                  more <code>annotation</code> and/or <code>annotation-xml</code> elements.
                  </p>
               <pre class="mathml">&lt;semantics&gt;
  &lt;mrow&gt;
    &lt;mrow&gt;
      &lt;mi&gt;sin&lt;/mi&gt;
      &lt;mo&gt;<span title="ApplyFunction">&amp;#x2061;</span><span class="uname">&lt;!--function application--&gt;</span>&lt;/mo&gt;
      &lt;mfenced&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/mfenced&gt;
    &lt;/mrow&gt;
    &lt;mo&gt;+&lt;/mo&gt;
    &lt;mn&gt;5&lt;/mn&gt;
  &lt;/mrow&gt;
  &lt;annotation encoding="application/x-tex"&gt;
    \sin x + 5
  &lt;/annotation&gt;
  &lt;annotation-xml encoding="application/openmath+xml"&gt;
    &lt;OMA xmlns="http://www.openmath.org/OpenMath"&gt;
      &lt;OMS cd="arith1" name="plus"/&gt;
      &lt;OMA&gt;&lt;OMS cd="transc1" name="sin"/&gt;&lt;OMV name="x"/&gt;&lt;/OMA&gt;
      &lt;OMI&gt;5&lt;/OMI&gt;
    &lt;/OMA&gt;
  &lt;/annotation-xml&gt;
&lt;/semantics&gt;</pre>
               <p id="html-xml1">Note that this example makes use of the namespace extensibility
                  that is only available in the XML syntax of MathML. If this example is included in
                  an HTML document
                  then it would be considered <em>invalid</em> and the OpenMath elements would be parsed as
                  elements in the MathML namespace. See <a href="#html.annotation.xml">Section&nbsp;5.2.3.3 Using <code>annotation-xml</code> in HTML documents</a> for details.</p>
               <p>The <code>semantics</code> element is considered to be both a presentation
                  element and a content element, and may be used in either context.
                  All MathML processors should process the <code>semantics</code> element,
                  even if they only process one of these two subsets of MathML.
                  </p>
            </div>
            <div class="div3">
               
               <h3><a id="mixing.annotation.keys"></a>5.1.2 Annotation keys</h3>
               <p>An <em>annotation key</em> specifies the relationship between an
                  expression and an annotation. Many kinds of relationships are possible.
                  Examples include alternate representations, specification or clarification
                  of semantics, type information, rendering hints, and private data
                  intended for specific processors.  The annotation key is the primary
                  means by which a processor determines whether or not to process an
                  annotation.</p>
               <p>The logical relationship between an expression and an annotation
                  can have a significant impact on the proper processing of the
                  expression.  For example, a particular annotation form, called <em>semantic  
                     attributions</em>, cannot be ignored without altering the meaning
                  of the annotated expression, at  
                  least in some processing contexts. On the other hand, alternate
                  representations do not alter the meaning of an expression, but may
                  alter the presentation of the expression as they are frequently used
                  to provide rendering hints.  Still other annotations carry private data or
                  metadata that are useful in a specific context, but do not alter either
                  the semantics or the presentation of the expression.</p>
               <p>In MathML 3, annotation keys are defined as symbols in <a href="chapter4.html#contm.cds">Content Dictionaries</a>, and are specified using
                  the <code>cd</code> and <code>name</code> attributes on the
                  <code>annotation</code> and <code>annotation-xml</code> elements.  For backward
                  compatibility with MathML 2, an annotation key may also be referenced
                  using the <code>definitionURL</code> attribute as an alternative to the
                  <code>cd</code> and <code>name</code> attributes.  Further details on
                  referencing symbols in Content Dictionaries are discussed in <a href="chapter4.html#contm.csymbol">Section&nbsp;4.2.3 Content Symbols <code>&lt;csymbol&gt;</code></a>.  The symbol definition in a Content Dictionary
                  for an annotation key may have a <code>role</code> property.  Two
                  particular roles are relevant for annotations:  a role of
                  "attribution" identifies a generic annotation that can
                  be ignored without altering the meaning of the annotated term, and a
                  role of "semantic-attribution" indicates that the annotation
                  is a semantic annotation, that is, the annotation cannot be ignored
                  without potentially altering the meaning of the expression.
                  </p>
               <p>MathML 3 provides two predefined annotation keys for the most common
                  kinds of annotations: <a href="http://www.openmath.org/cd/mathmlkeys.xhtml#alternate-representation">alternate-representation</a> and <a href="http://www.openmath.org/cd/mathmlkeys.xhtml#contentequiv">contentequiv</a> defined in the <a href="http://www.openmath.org/cd/mathmlkeys.xhtml">mathmlkeys</a> content
                  dictionary. The <a href="http://www.openmath.org/cd/mathmlkeys.xhtml#alternate-representation">alternate-representation</a> annotation key specifies that the
                  annotation value provides an alternate representation for an
                  expression in some other markup language, and the <a href="http://www.openmath.org/cd/mathmlkeys.xhtml#contentequiv">contentequiv</a> annotation key specifies that
                  the annotation value provides a semantically equivalent alternative
                  for the annotated expression.  Further details about the use of
                  these keys is given in the sections below.</p>
               <p>The default annotation key is <a href="http://www.openmath.org/cd/mathmlkeys.xhtml#alternate-representation">alternate-representation</a> when no annotation key is
                  explicitly specified on an <code>annotation</code> or
                  <code>annotation-xml</code> element.</p>
               <p>Typically, annotation keys specify only the logical nature of the
                  relationship between an expression and an annotation.  The data format
                  for an annotation is indicated with the <code>encoding</code>
                  attribute.  In MathML 2, the <code>encoding</code> attribute was the
                  primary information that a processor could use to determine whether or
                  not it could understand an annotation.  For backward compatibility,
                  processors are encouraged to examine both the annotation key and
                  <code>encoding</code> attribute.  In
                  particular, MathML 2 specified the predefined encoding values
                  <code>MathML</code>, <code>MathML-Content</code>, and
                  <code>MathML-Presentation</code>.  The <code>MathML</code> encoding
                  value is used to indicate an <code>annotation-xml</code> element contains
                  a MathML expression.  The use of the other values is more specific, as
                  discussed in following sections.</p>
               <p>While the predefined <a href="http://www.openmath.org/cd/mathmlkeys.xhtml#alternate-representation">alternate-representation</a> and <a href="http://www.openmath.org/cd/mathmlkeys.xhtml#contentequiv">contentequiv</a> keys cover many common use cases, user
                  communities are encouraged to define and standardize additional
                  content dictionaries as necessary.  Annotation keys in user-defined,
                  public Content Dictionaries are preferred over private encoding
                  attribute value conventions, since content dictionaries are more
                  expressive, more open and more maintainable than private encoding
                  values.  However, for backward compatibility with MathML 2, the
                  encoding attribute may also be used.
                  </p>
            </div>
            <div class="div3">
               
               <h3><a id="mixing.alternate.representations"></a>5.1.3 Alternate representations</h3>
               <p>Alternate representation annotations are most often used to
                  provide renderings for an expression, or to provide an equivalent
                  representation in another markup language.  In general, alternate
                  representation annotations do not alter the meaning of the annotated
                  expression, but may alter its presentation.</p>
               <p>A particularly important case is the use of a presentation MathML
                  expression to indicate a preferred rendering for a content MathML
                  expression.  This case may be represented by labeling the annotation
                  with the <code>application/mathml-presentation+xml</code> value for
                  the <code>encoding</code> attribute.  For backward compatibility with
                  MathML 2.0, this case can also be represented with the equivalent
                  <code>MathML-Presentation</code> value for the <code>encoding</code>
                  attribute.  Note that when a presentation MathML annotation is
                  present in a <code>semantics</code> element, it may be used as the
                  default rendering of the <code>semantics</code> element, instead of
                  the default rendering of the first child.
                  </p>
               <p>In the example below, the <code>semantics</code> element binds together
                  various alternate representations for a content MathML expression.
                  The presentation MathML annotation may be used as the
                  default rendering, while the other annotations give representations
                  in other markup languages.  Since no attribution keys are explicitly
                  specified, the default annotation key
                  <a href="http://www.openmath.org/cd/mathmlkeys.xhtml#alternate-representation">alternate-representation</a> applies
                  to each of the annotations.
                  </p>
               <pre class="mathml">
&lt;semantics&gt;
  &lt;apply&gt;
    &lt;plus/&gt;
    &lt;apply&gt;&lt;sin/&gt;&lt;ci&gt;x&lt;/ci&gt;&lt;/apply&gt;
    &lt;cn&gt;5&lt;/cn&gt;
  &lt;/apply&gt;
  &lt;annotation-xml encoding="MathML-Presentation"&gt;
    &lt;mrow&gt;
      &lt;mrow&gt;
        &lt;mi&gt;sin&lt;/mi&gt;
        &lt;mo&gt;<span title="ApplyFunction">&amp;#x2061;</span><span class="uname">&lt;!--function application--&gt;</span>&lt;/mo&gt;
        &lt;mfenced open="(" close=")"&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/mfenced&gt;
      &lt;/mrow&gt;
      &lt;mo&gt;+&lt;/mo&gt;
      &lt;mn&gt;5&lt;/mn&gt;
    &lt;/mrow&gt;
  &lt;/annotation-xml&gt;
  &lt;annotation encoding="application/x-maple"&gt;
    sin(x) + 5
  &lt;/annotation&gt;
  &lt;annotation encoding="application/vnd.wolfram.mathematica"&gt;
    Sin[x] + 5
  &lt;/annotation&gt;
  &lt;annotation encoding="application/x-tex"&gt;
    \sin x + 5
  &lt;/annotation&gt;
  &lt;annotation-xml encoding="application/openmath+xml"&gt;
    &lt;OMA xmlns="http://www.openmath.org/OpenMath"&gt;
      &lt;OMA&gt;
        &lt;OMS cd="arith1" name="plus"/&gt;
        &lt;OMA&gt;&lt;OMS cd="transc1" name="sin"/&gt;&lt;OMV name="x"/&gt;&lt;/OMA&gt;
        &lt;OMI&gt;5&lt;/OMI&gt;
      &lt;/OMA&gt;
    &lt;/OMA&gt;
  &lt;/annotation-xml&gt;
&lt;/semantics&gt;</pre>
               <p id="html-xml2">Note that this example makes use of the namespace extensibility
                  that is only available in the XML syntax of MathML. If this example is included in
                  an HTML document
                  then it would be considered <em>invalid</em> and the OpenMath elements would be parsed as
                  elements un the MathML namespace. See <a href="#html.annotation.xml">Section&nbsp;5.2.3.3 Using <code>annotation-xml</code> in HTML documents</a> for details.</p>
            </div>
            <div class="div3">
               
               <h3><a id="mixing.content.equiv"></a>5.1.4 Content equivalents</h3>
               <p>Content equivalent annotations provide additional computational
                  information about an expression.  Annotations with the
                  <a href="http://www.openmath.org/cd/mathmlkeys.xhtml#contentequiv">contentequiv</a> key cannot be ignored
                  without potentially changing the behavior of an expression.</p>
               <p>An important case arises when a content MathML annotation is used
                  to disambiguate the meaning of a presentation MathML expression.
                  This case may be represented by labeling the annotation with the
                  <code>application/mathml-content+xml</code> value for the
                  <code>encoding</code> attribute.  In
                  MathML 2, this type of annotation was represented with the equivalent
                  <code>MathML-Content</code> value for the <code>encoding</code> attribute,
                  so processors are urged to support this usage for backward compatibility.
                  A content MathML annotation, whether in MathML 2 or 3, may be used for
                  other purposes as well, such as for other kinds of semantic assertions.
                  Consequently, in MathML 3, the
                  <a href="http://www.openmath.org/cd/mathmlkeys.xhtml#contentequiv">contentequiv</a> annotation key should
                  be used to make an explicit assertion that the annotation provides a
                  definitive content markup equivalent for an expression.</p>
               <p>In the example below, an ambiguous presentation MathML expression
                  is annotated with a <code>MathML-Content</code> annotation clarifying
                  its precise meaning.</p>
               <pre class="mathml">
&lt;semantics&gt;
  &lt;mrow&gt;
    &lt;mrow&gt;
      &lt;mi&gt;a&lt;/mi&gt;
      &lt;mfenced open="(" close=")"&gt;
        &lt;mrow&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;5&lt;/mn&gt;&lt;/mrow&gt;
      &lt;/mfenced&gt;
    &lt;/mrow&gt;
  &lt;/mrow&gt;
  &lt;annotation-xml cd="mathmlkeys" name="contentequiv"
                  encoding="MathML-Content"&gt;
    &lt;apply&gt;
      &lt;ci&gt;a&lt;/ci&gt;
      &lt;apply&gt;&lt;plus/&gt;&lt;ci&gt;x&lt;/ci&gt;&lt;cn&gt;5&lt;/cn&gt;&lt;/apply&gt;
    &lt;/apply&gt;
  &lt;/annotation-xml&gt;
&lt;/semantics&gt;</pre>
            </div>
            <div class="div3">
               
               <h3><a id="mixing.annotation.references"></a>5.1.5 Annotation references</h3>
               <p>In the usual case, each annotation element includes either character data
                  content (in the case of <code>annotation</code>) or XML markup data (in the case
                  of <code>annotation-xml</code>) that represents the <em>annotation value</em>.
                  There is no restriction on the type of annotation that may appear within a
                  <code>semantics</code> element.  For example, an annotation could provide a
                  T<span style="vertical-align:-.4ex; margin-left:-.15ex; margin-right:-.15ex">E</span>X encoding, a linear input form for a computer algebra system,
                  a rendered image, or detailed mathematical type information.</p>
               <p>In some cases the alternative children of a <code>semantics</code> element
                  are not an essential part of the behavior of the annotated expression, but
                  may be useful to specialized processors.  To enable the availability of
                  several annotation formats in a more efficient manner, a <code>semantics</code>
                  element may contain empty <code>annotation</code> and <code>annotation-xml</code>
                  elements that provide <code>encoding</code> and <code>src</code> attributes
                  to specify an external location for the annotation value associated with
                  the annotation.  This type of annotation is known as an <em>annotation
                     reference</em>.</p>
               <pre class="mathml-fragment">
&lt;semantics&gt;
  &lt;mfrac&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mrow&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;/mrow&gt;&lt;/mfrac&gt;
  &lt;annotation encoding="image/png" src="333/formula56.png"/&gt;
  &lt;annotation encoding="application/x-maple" src="333/formula56.ms"/&gt;
&lt;/semantics&gt;</pre>
               <p>Processing agents that anticipate that consumers of exported markup may
                  not be able to retrieve the external entity referenced by such annotations
                  should request the content of the external entity at the indicated location
                  and replace the annotation with its expanded form.</p>
               <p>An annotation reference follows the same rules as for other annotations
                  to determine the annotation key that specifies the relationship between
                  the annotated object and the annotation value.</p>
            </div>
         </div>
         <div class="div2">
            
            <h2><a id="mixing.semantic.elements"></a>5.2 Elements for Semantic Annotations</h2>
            <p>This section explains the semantic mapping elements <code>semantics</code>,
               <code>annotation</code>, and <code>annotation-xml</code>.  These elements associate
               alternate representations for a presentation or content expression, or
               associate semantic or other attributions that may modify the meaning of
               the annotated expression.</p>
            <div class="div3">
               
               <h3><a id="mixing.elements.semantics"></a>5.2.1 The <code>&lt;semantics&gt;</code> element</h3>
               <div class="div4">
                  
                  <h4><a id="id.5.2.1.1"></a>5.2.1.1 Description</h4>
                  <p>The <code>semantics</code> element is the container element that
                     associates annotations with a MathML expression.  The
                     <code>semantics</code> element has as its first child the expression to be
                     annotated.  Any MathML expression may appear as the first child of the
                     <code>semantics</code> element.  Subsequent <code>annotation</code> and
                     <code>annotation-xml</code> children enclose the annotations.
                     An annotation represented in XML is enclosed in an
                     <code>annotation-xml</code> element.  An annotation represented
                     in character data is enclosed in an <code>annotation</code> element.</p>
                  <p>As noted above, the <code>semantics</code> element is considered to be
                     both a presentation element and a content element, since it can act
                     as either, depending on its content.  Consequently, all MathML
                     processors should process the <code>semantics</code> element, even if they
                     process only presentation markup or only content markup.
                     </p>
                  <p>The default rendering of a <code>semantics</code> element is the default
                     rendering of its first child.  A renderer may use the information contained
                     in the annotations to customize its rendering of the annotated element.</p>
                  <pre class="mathml">&lt;semantics&gt;
  &lt;mrow&gt;
    &lt;mrow&gt;
      &lt;mi&gt;sin&lt;/mi&gt;
      &lt;mo&gt;<span title="ApplyFunction">&amp;#x2061;</span><span class="uname">&lt;!--function application--&gt;</span>&lt;/mo&gt;
      &lt;mfenced&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/mfenced&gt;
    &lt;/mrow&gt;
    &lt;mo&gt;+&lt;/mo&gt;
    &lt;mn&gt;5&lt;/mn&gt;
  &lt;/mrow&gt;
  &lt;annotation-xml cd="mathmlkeys" name="contentequiv" encoding="MathML-Content"&gt;
    &lt;apply&gt;
      &lt;plus/&gt;
      &lt;apply&gt;&lt;sin/&gt;&lt;ci&gt;x&lt;/ci&gt;&lt;/apply&gt;
      &lt;cn&gt;5&lt;/cn&gt;
    &lt;/apply&gt;
  &lt;/annotation-xml&gt;
  &lt;annotation encoding="application/x-tex"&gt;
    \sin x + 5
  &lt;/annotation&gt;
&lt;/semantics&gt;</pre>
               </div>
               <div class="div4">
                  
                  <h4><a id="id.5.2.1.2"></a>5.2.1.2 Attributes</h4>
                  
                  <table class="attributes">
                     <thead>
                        <tr>
                           <th>Name</th>
                           <th>values</th>
                           <th>default</th>
                        </tr>
                     </thead>
                     <tbody>
                        <tr>
                           <td rowspan="2" class="attname">definitionURL</td>
                           <td><a href="chapter2.html#type.uri"><em>URI</em></a></td>
                           <td><em>none</em></td>
                        </tr>
                        <tr>
                           <td colspan="2" class="attdesc">The location of an external source for semantic information</td>
                        </tr>
                        <tr>
                           <td rowspan="2" class="attname">encoding</td>
                           <td><a href="chapter2.html#type.string"><em>string</em></a></td>
                           <td><em>none</em></td>
                        </tr>
                        <tr>
                           <td colspan="2" class="attdesc">The encoding of the external semantic information</td>
                        </tr>
                     </tbody>
                  </table>
                  
                  <p>The <code>semantics</code> element takes the <code>definitionURL</code> and
                     <code>encoding</code> attributes, which reference an external source for some
                     or all of the semantic information for the annotated element, as modified
                     by the annotation.  The use of these attributes on the <code>semantics</code>
                     element is deprecated in MathML3.
                     </p>
               </div>
            </div>
            <div class="div3">
               
               <h3><a id="mixing.elements.annotation"></a>5.2.2 The <code>&lt;annotation&gt;</code> element</h3>
               <div class="div4">
                  
                  <h4><a id="id.5.2.2.1"></a>5.2.2.1 Description</h4>
                  <p>The <code>annotation</code> element is the container element for a semantic
                     annotation whose representation is parsed character data in a non-XML
                     format.  The <code>annotation</code> element should contain the character
                     data for the annotation, and should not contain XML markup elements.
                     If the annotation contains one of the XML reserved characters
                     <code>&amp;</code>, <code>&lt;</code> then these characters must
                     be encoded using an entity reference or
                     (in the XML syntax) 
                     an XML <code>CDATA</code> section.</p>
               </div>
               <div class="div4">
                  
                  <h4><a id="id.5.2.2.2"></a>5.2.2.2 Attributes</h4>
                  
                  <table class="attributes">
                     <thead>
                        <tr>
                           <th>Name</th>
                           <th>values</th>
                           <th>default</th>
                        </tr>
                     </thead>
                     <tbody>
                        <tr>
                           <td rowspan="2" class="attname">definitionURL</td>
                           <td><a href="chapter2.html#type.uri"><em>URI</em></a></td>
                           <td><em>none</em></td>
                        </tr>
                        <tr>
                           <td colspan="2" class="attdesc">The location of the annotation key symbol</td>
                        </tr>
                        <tr>
                           <td rowspan="2" class="attname">encoding</td>
                           <td><a href="chapter2.html#type.string"><em>string</em></a></td>
                           <td><em>none</em></td>
                        </tr>
                        <tr>
                           <td colspan="2" class="attdesc">The encoding of the semantic information in the annotation</td>
                        </tr>
                        <tr>
                           <td rowspan="2" class="attname">cd</td>
                           <td><a href="chapter2.html#type.string"><em>string</em></a></td>
                           <td>mathmlkeys</td>
                        </tr>
                        <tr>
                           <td colspan="2" class="attdesc">The content dictionary that contains the annotation key symbol</td>
                        </tr>
                        <tr>
                           <td rowspan="2" class="attname">name</td>
                           <td><a href="chapter2.html#type.string"><em>string</em></a></td>
                           <td>alternate-representation</td>
                        </tr>
                        <tr>
                           <td colspan="2" class="attdesc">The name of the annotation key symbol</td>
                        </tr>
                        <tr>
                           <td rowspan="2" class="attname">src</td>
                           <td><a href="chapter2.html#type.uri"><em>URI</em></a></td>
                           <td><em>none</em></td>
                        </tr>
                        <tr>
                           <td colspan="2" class="attdesc">The location of an external source for semantic information</td>
                        </tr>
                     </tbody>
                  </table>
                  
                  <p>Taken together, the <code>cd</code> and <code>name</code> attributes
                     specify the annotation key symbol, which identifies the relationship
                     between the annotated element and the annotation, as described in
                     <a href="#mixing.annotation.elements">Section&nbsp;5.1.1 Annotation elements</a>. The <code>definitionURL</code>
                     attribute provides an alternate way to reference the annotation key
                     symbol as a single attribute.  If none of these attributes are present,
                     the annotation key symbol is the symbol
                     <a href="http://www.openmath.org/cd/mathmlkeys.xhtml#alternate-representation">alternate-representation</a>
                     from the <a href="http://www.openmath.org/cd/mathmlkeys.xhtml">mathmlkeys</a> content dictionary.</p>
                  <p>The <code>encoding</code> attribute describes the content type of the
                     annotation.  The value of the <code>encoding</code> attribute may contain
                     a media type that identifies the data format for the encoding data.  For
                     data formats that do not have an associated media type, implementors may
                     choose a self-describing character string to identify their content type.</p>
                  <p>The <code>src</code> attribute provides a mechanism to attach external
                     entities as annotations on MathML expressions.</p>
                  <pre class="mathml-fragment">
&lt;annotation encoding="image/png" src="333/formula56.png"/&gt;</pre>
                  <p>The <code>annotation</code> element is a semantic mapping element that may
                     only be used as a child of the <code>semantics</code> element.  While there is
                     no default rendering for the <code>annotation</code> element, a renderer may
                     use the information contained in an annotation to customize its rendering
                     of the annotated element.</p>
               </div>
            </div>
            <div class="div3">
               
               <h3><a id="mixing.elements.annotation.xml"></a>5.2.3 The <code>&lt;annotation-xml&gt;</code> element</h3>
               <div class="div4">
                  
                  <h4><a id="id.5.2.3.1"></a>5.2.3.1 Description</h4>
                  <p>The <code>annotation-xml</code> element is the container element for a
                     semantic annotation whose representation is structured markup.  The <code>annotation-xml</code> element should contain the markup
                     elements, attributes, and character data for the annotation.</p>
               </div>
               <div class="div4">
                  
                  <h4><a id="id.5.2.3.2"></a>5.2.3.2 Attributes</h4>
                  
                  <table class="attributes">
                     <thead>
                        <tr>
                           <th>Name</th>
                           <th>values</th>
                           <th>default</th>
                        </tr>
                     </thead>
                     <tbody>
                        <tr>
                           <td rowspan="2" class="attname">definitionURL</td>
                           <td><a href="chapter2.html#type.uri"><em>URI</em></a></td>
                           <td><em>none</em></td>
                        </tr>
                        <tr>
                           <td colspan="2" class="attdesc">The location of the annotation key symbol</td>
                        </tr>
                        <tr>
                           <td rowspan="2" class="attname">encoding</td>
                           <td><a href="chapter2.html#type.string"><em>string</em></a></td>
                           <td><em>none</em></td>
                        </tr>
                        <tr>
                           <td colspan="2" class="attdesc">The encoding of the semantic information in the annotation</td>
                        </tr>
                        <tr>
                           <td rowspan="2" class="attname">cd</td>
                           <td><a href="chapter2.html#type.string"><em>string</em></a></td>
                           <td>mathmlkeys</td>
                        </tr>
                        <tr>
                           <td colspan="2" class="attdesc">The content dictionary that contains the annotation key symbol</td>
                        </tr>
                        <tr>
                           <td rowspan="2" class="attname">name</td>
                           <td><a href="chapter2.html#type.string"><em>string</em></a></td>
                           <td>alternate-representation</td>
                        </tr>
                        <tr>
                           <td colspan="2" class="attdesc">The name of the annotation key symbol</td>
                        </tr>
                        <tr>
                           <td rowspan="2" class="attname">src</td>
                           <td><a href="chapter2.html#type.uri"><em>URI</em></a></td>
                           <td><em>none</em></td>
                        </tr>
                        <tr>
                           <td colspan="2" class="attdesc">The location of an external source for semantic information</td>
                        </tr>
                     </tbody>
                  </table>
                  
                  <p>Taken together, the <code>cd</code> and <code>name</code> attributes
                     specify the annotation key symbol, which identifies the relationship
                     between the annotated element and the annotation, as described in
                     <a href="#mixing.annotation.elements">Section&nbsp;5.1.1 Annotation elements</a>. The <code>definitionURL</code>
                     attribute provides an alternate way to reference the annotation key
                     symbol as a single attribute.  If none of these attributes are present,
                     the annotation key symbol is the symbol
                     <a href="http://www.openmath.org/cd/mathmlkeys.xhtml#alternate-representation">alternate-representation</a>
                     from the <a href="http://www.openmath.org/cd/mathmlkeys.xhtml">mathmlkeys</a> content dictionary.</p>
                  <p>The <code>encoding</code> attribute describes the content type of the
                     annotation.  The value of the <code>encoding</code> attribute may contain
                     a media type that identifies the data format for the encoding data.  For
                     data formats that do not have an associated media type, implementors may
                     choose a self-describing character string to identify their content type.
                     In particular, as described above and in <a href="chapter6.html#encoding-names">Section&nbsp;6.2.4 Names of MathML Encodings</a>, MathML specifies
                     <code>MathML</code>, <code>MathML-Presentation</code>, and
                     <code>MathML-Content</code> as predefined values for the
                     <code>encoding</code> attribute.   Finally, The <code>src</code>
                     attribute provides a mechanism to attach external XML entities as
                     annotations on MathML expressions.</p>
                  <pre class="mathml-fragment">&lt;annotation-xml cd="mathmlkeys" name="contentequiv" encoding="MathML-Content"&gt;
  &lt;apply&gt;
    &lt;plus/&gt;
    &lt;apply&gt;&lt;sin/&gt;&lt;ci&gt;x&lt;/ci&gt;&lt;/apply&gt;
    &lt;cn&gt;5&lt;/cn&gt;
  &lt;/apply&gt;
&lt;/annotation-xml&gt;

&lt;annotation-xml encoding="application/openmath+xml"&gt;
  &lt;OMA xmlns="http://www.openmath.org/OpenMath"&gt;
    &lt;OMS cd="arith1" name="plus"/&gt;
    &lt;OMA&gt;&lt;OMS cd="transc1" name="sin"/&gt;&lt;OMV name="x"/&gt;&lt;/OMA&gt;
    &lt;OMI&gt;5&lt;/OMI&gt;
  &lt;/OMA&gt;
&lt;/annotation-xml&gt;</pre>
                  <p>When the MathML is being parsed as XML and 
                     the annotation value is represented in an XML dialect other than MathML, the
                     namespace for the XML markup for the annotation should be identified by means of namespace
                     attributes and/or namespace prefixes on the annotation value.  For instance:</p>
                  <pre class="mathml-fragment">
&lt;annotation-xml encoding="application/xhtml+xml"&gt;
  &lt;html xmlns="http://www.w3.org/1999/xhtml"&gt;
    &lt;head&gt;&lt;title&gt;E&lt;/title&gt;&lt;/head&gt;
    &lt;body&gt;
      &lt;p&gt;The base of the natural logarithms, approximately 2.71828.&lt;/p&gt;
    &lt;/body&gt;
  &lt;/html&gt;
&lt;/annotation-xml&gt;</pre>
                  <p>The <code>annotation-xml</code> element is a semantic mapping element that may only be used
                     as a child of the <code>semantics</code> element.  While there is no default rendering for the
                     <code>annotation-xml</code> element, a renderer may use the information contained in an
                     annotation to customize its rendering of the annotated element.</p>
               </div>
               <div class="div4">
                  
                  <h4><a id="html.annotation.xml"></a>5.2.3.3 Using <code>annotation-xml</code> in HTML documents</h4>
                  <p>Note that the Namespace extensibility used in the above examples
                     may not be available if the MathML is not being treated as an XML document. In particular
                     HTML parsers
                     treat <code>xmlns</code> attributes as ordinary attributes, so the OpenMath example would be classified as
                     invalid
                     by an HTML validator. The OpenMath elements would still be parsed as children of the
                     <code>annotation-xml</code> element, however they would be placed in the <em>MathML</em> namespace. The above examples are not rendered in the HTML version of this specification,
                     to ensure that that document is a valid HTML5 document.</p>
                  <p>The details of the HTML parser handling of <code>annotation-xml</code> is specified in <a href="appendixg.html#HTML5">[HTML5]</a> and summarized in <a href="chapter6.html#interf.html">Section&nbsp;6.4.3 Mixing MathML and HTML</a>, however the main differences from the behavior of an XML parser that affect MathML
                     annotations are that the HTML parser does not treat <code>xmlns</code> attributes, nor <code>:</code> in element names as special and has built-in rules determining whether the three
                     "known" namespaces, HTML, SVG or MathML are used.
                     </p>
                  <ul>
                     <li>
                        <p>If the <code>annotation-xml</code> has an <code>encoding</code> attribute that is (ignoring case differences) "text/html" or "annotation/xhtml+xml"
                           then the content  is parsed as HTML and placed (initially) in the HTML namespace.</p>
                     </li>
                     <li>
                        <p>Otherwise it is parsed as <em>foreign content</em> and parsed in a more XML-like manner (like MathML itself in HTML) in which <code>/&gt;</code> signifies an empty element. Content will be placed in the MathML namespace.</p>
                        <p>If any recognised HTML element appears in this foreign content annotation the HTML
                           parser will effectively termnate the math expression, closing all open elements until
                           the <code>math</code> element is closed, and then process the nested HTML as if it were not inside the
                           math context. Any following MathML elements will then not render correctly as they
                           are not in a math context, or in the MathML namespace.</p>
                     </li>
                  </ul>
                  <p>These issues mean that the following example is valid whether parsed by an XML or
                     HTML parser:
                     </p>
                  <pre class="mathml-fragment">
&lt;math&gt;
 &lt;semantics&gt;
  &lt;mi&gt;a&lt;/mi&gt;
  &lt;annotation-xml encoding="text/html"&gt;
   &lt;span&gt;xxx&lt;/span&gt;
  &lt;/annotation-xml&gt;
 &lt;/semantics&gt;
 &lt;mo&gt;+&lt;/mo&gt;
 &lt;mi&gt;b&lt;/mi&gt;
&lt;/math&gt;
</pre>
                  <p>
                     
                     However the if the <code>encoding</code> attribute is omitted then the expression
                     is only valid if parsed as XML:
                     
                     </p>
                  <pre class="error">
&lt;math&gt;
 &lt;semantics&gt;
  &lt;mi&gt;a&lt;/mi&gt;
  &lt;annotation-xml&gt;
   &lt;span&gt;xxx&lt;/span&gt;
  &lt;/annotation-xml&gt;
 &lt;/semantics&gt;
 &lt;mo&gt;+&lt;/mo&gt;
 &lt;mi&gt;b&lt;/mi&gt;
&lt;/math&gt;
</pre>
                  <p>If the above is parsed by an HTML parser it produces a result equivalent to the following
                     invalid input, where the <code>span</code> element has caused all MathML elements to be prematurely closed. The remaining MathML
                     elements following the <code>span</code> are no longer contained within <code>&lt;math&gt;</code> so will be parsed as unknown HTML elements and render incorrectly.
                     </p>
                  <pre class="error">
&lt;math xmlns="http://www.w3.org/1998/Math/MathML"&gt;
 &lt;semantics&gt;
  &lt;mi&gt;a&lt;/mi&gt;
  &lt;annotation-xml&gt;
  &lt;/annotation-xml&gt;
 &lt;/semantics&gt;
&lt;/math&gt;
&lt;span xmlns="http://www.w3.org/1999/xhtml"&gt;xxx&lt;/span&gt;
&lt;mo xmlns="http://www.w3.org/1999/xhtml"&gt;+&lt;/mo&gt;
&lt;mi xmlns="http://www.w3.org/1999/xhtml"&gt;b&lt;/mi&gt;
</pre>
                  <p>Note here that the HTML <code>span</code> element has
                     caused all open MathML elements to be prematurely closed, resulting in
                     the following MathML elements being treated as unknown HTML elements
                     as they are no longer descendents of <code>math</code>. See <a href="chapter6.html#interf.html">Section&nbsp;6.4.3 Mixing MathML and HTML</a> for more details of the parsing of MathML in HTML.
                     </p>
                  <p>Any use of elements in other vocabularies (such as the OpenMath
                     examples above) is considered <em>invalid</em> in HTML.  If
                     validity is not a strict requirement it is possible to use such
                     elements but they will be parsed as elements on the
                     <em>MathML</em> namespace. Documents SHOULD NOT use namespace
                     prefixes and element names containing colon (<code>:</code>) as the
                     element nodes produced by the HTML parser with have local names
                     containing a colon, which can not be constructed by a namespace aware
                     XML parser. Rather than use such foreign annotations, when using an HTML parser
                     it is better to encode the annotation using the existing
                     vocabulary. For example as shown in <a href="chapter4.html">Chapter&nbsp;4 Content Markup</a> OpenMath
                     may be encoded faithfuly as <em>Strict Content
                        MathML</em>. Similarly RDF annotations could be encoded using RDFa
                     in <code>text/html</code> annotation or (say) N3 notation in
                     <code>annotation</code> rather than using RDF/XML encoding in an
                     <code>annotation-xml</code> element.</p>
               </div>
            </div>
         </div>
         <div class="div2">
            
            <h2><a id="mixing.markup"></a>5.3 Combining Presentation and Content Markup</h2>
            <p>
               Presentation markup encodes the <em>notational structure</em> of an expression.
               Content markup encodes the <em>functional structure</em> of an expression.  In certain
               cases, a particular application of MathML may require a combination of both presentation
               and content markup.  This section describes specific constraints that govern the use
               of
               presentation markup within content markup, and vice versa.
               </p>
            <div class="div3">
               
               <h3><a id="mixing.pmincm"></a>5.3.1 Presentation Markup in Content Markup</h3>
               <p>
                  Presentation markup may be embedded within content markup so long as the
                  resulting expression retains an unambiguous function application structure.
                  
                  Specifically, presentation markup may only appear in content markup
                  in three ways:
                  </p>
               <ol type="1">
                  <li>
                     <p>within <code>ci</code> and <code>cn</code> token elements</p>
                  </li>
                  <li>
                     <p>within the <code>csymbol</code> element</p>
                  </li>
                  <li>
                     <p>within the <code>semantics</code> element</p>
                  </li>
               </ol>
               <p>
                  Any other presentation markup occurring within content markup is a
                  MathML error.  More detailed discussion of these three cases follows:
                  </p>
               <dl>
                  <dt class="label">Presentation markup within token elements.</dt>
                  <dd>The token elements <code>ci</code> and <code>cn</code> are permitted to
                     contain any sequence of MathML characters (defined in <a href="chapter7.html">Chapter&nbsp;7 Characters, Entities and Fonts</a>)
                     and/or presentation elements.  Contiguous blocks of MathML characters in
                     <code>ci</code> or <code>cn</code> elements are treated as if wrapped in
                     <code>mi</code> or <code>mn</code> elements, as appropriate, and the resulting
                     collection of presentation elements is rendered as if wrapped in an
                     implicit <code>mrow</code> element.</dd>
                  <dt class="label">Presentation markup within the <code>csymbol</code> element.</dt>
                  <dd>The <code>csymbol</code> element may contain either MathML characters
                     interspersed with presentation markup, or content markup.  It is a MathML
                     error for a <code>csymbol</code> element to contain both presentation and
                     content elements.  When the <code>csymbol</code> element contains
                     character data and presentation markup, the same rendering rules that apply
                     to the token elements <code>ci</code> and <code>cn</code> should be used.</dd>
                  <dt class="label">Presentation markup within the <code>semantics</code> element.</dt>
                  <dd>One of the main purposes of the <code>semantics</code> element is to
                     provide a mechanism for incorporating arbitrary MathML expressions into
                     content markup in a semantically meaningful way.  In particular, any valid
                     presentation expression can be embedded in a content expression by placing
                     it as the first child of a <code>semantics</code> element.  The meaning of this
                     wrapped expression should be indicated by one or more annotation elements
                     also contained in the <code>semantics</code> element.</dd>
               </dl>
            </div>
            <div class="div3">
               
               <h3><a id="mixing.cminpm"></a>5.3.2 Content Markup in Presentation Markup</h3>
               <p>
                  Content markup may be embedded within presentation markup so long as the
                  resulting expression has an unambiguous rendering.  That is, it must be
                  possible, in principle, to produce a presentation markup fragment for
                  each content markup fragment that appears in the combined expression.
                  The replacement of each content markup fragment by its corresponding
                  presentation markup should produce a well-formed presentation markup
                  expression.  A presentation engine should then be able to process this
                  presentation expression without reference to the content markup bits
                  included in the original expression.
                  </p>
               <p>
                  In general, this constraint means that each embedded content expression
                  must be well-formed, as a content expression, and must be able to stand
                  alone outside the context of any containing content markup element.  As
                  a result, the following content elements may not appear as an immediate
                  child of a presentation element:
                  <code>annotation</code>, <code>annotation-xml</code>,
                  <code>bvar</code>, <code>condition</code>, <code>degree</code>,
                  <code>logbase</code>, <code>lowlimit</code>, <code>uplimit</code>.
                  </p>
               <p>
                  In addition, within presentation markup, content markup may not appear
                  within presentation token elements.
                  </p>
            </div>
         </div>
         <div class="div2">
            
            <h2><a id="mixing.parallel"></a>5.4 Parallel Markup</h2>
            <p>
               Some applications are able to use <em>both</em> presentation
               and content information.  <em>Parallel markup</em> is a way to
               combine two or more markup trees for the same mathematical expression.
               Parallel markup is achieved with the <code>semantics</code> element.
               Parallel markup for an expression may appear on its own, or as part
               of a larger content or presentation tree.
               </p>
            <div class="div3">
               
               <h3><a id="mixing.top.level"></a>5.4.1 Top-level Parallel Markup</h3>
               <p>
                  In many cases, the goal is to provide presentation markup and content
                  markup for a mathematical expression as a whole.
                  A single <code>semantics</code> element may be used to pair two markup trees,
                  where one child element provides the presentation markup, and the
                  other child element provides the content markup.</p>
               <p>
                  The following example encodes the Boolean arithmetic expression
                  (<var>a</var>+<var>b</var>)(<var>c</var>+<var>d</var>) in this way.
                  </p>
               <pre class="mathml">
&lt;semantics&gt;
  &lt;mrow&gt;
    &lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt; &lt;mo&gt;+&lt;/mo&gt; &lt;mi&gt;b&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;
    &lt;mo&gt;<span title="InvisibleTimes">&amp;#x2062;</span><span class="uname">&lt;!--invisible times--&gt;</span>&lt;/mo&gt;
    &lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;c&lt;/mi&gt; &lt;mo&gt;+&lt;/mo&gt; &lt;mi&gt;d&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;
  &lt;/mrow&gt;
  &lt;annotation-xml encoding="MathML-Content"&gt;
    &lt;apply&gt;&lt;and/&gt;
      &lt;apply&gt;&lt;xor/&gt;&lt;ci&gt;a&lt;/ci&gt; &lt;ci&gt;b&lt;/ci&gt;&lt;/apply&gt;
      &lt;apply&gt;&lt;xor/&gt;&lt;ci&gt;c&lt;/ci&gt; &lt;ci&gt;d&lt;/ci&gt;&lt;/apply&gt;
    &lt;/apply&gt;
  &lt;/annotation-xml&gt;
&lt;/semantics&gt;</pre>
               <p>
                  Note that the above markup annotates the presentation markup as
                  the first child element, with the content markup as part of the
                  <code>annotation-xml</code> element.  An equivalent form could be given
                  that annotates the content markup as the first child element, with
                  the presentation markup as part of the <code>annotation-xml</code> element.
                  </p>
            </div>
            <div class="div3">
               
               <h3><a id="mixing.cr"></a>5.4.2 Parallel Markup via Cross-References</h3>
               <p>
                  To accommodate applications that must process sub-expressions of large
                  objects, MathML supports cross-references between the branches of a
                  <code>semantics</code> element to identify corresponding sub-structures.
                  These cross-references are established by the use of the <code>id</code>
                  and <code>xref</code> attributes within a <code>semantics</code> element.
                  This application of the <code>id</code> and <code>xref</code> attributes within
                  a <code>semantics</code> element should be viewed as best practice to enable
                  a recipient to select arbitrary sub-expressions in each alternative
                  branch of a <code>semantics</code> element.  The <code>id</code> and
                  <code>xref</code> attributes may be placed on MathML elements of any type.
                  </p>
               <p>
                  The following example demonstrates cross-references for the
                  Boolean arithmetic expression
                  (<var>a</var>+<var>b</var>)(<var>c</var>+<var>d</var>).
                  
                  </p>
               <pre class="mathml">
&lt;semantics&gt;
  &lt;mrow id="E"&gt;
    &lt;mrow id="E.1"&gt;
      &lt;mo id="E.1.1"&gt;(&lt;/mo&gt;
      &lt;mi id="E.1.2"&gt;a&lt;/mi&gt;
      &lt;mo id="E.1.3"&gt;+&lt;/mo&gt;
      &lt;mi id="E.1.4"&gt;b&lt;/mi&gt;
      &lt;mo id="E.1.5"&gt;)&lt;/mo&gt;
    &lt;/mrow&gt;
    &lt;mo id="E.2"&gt;<span title="InvisibleTimes">&amp;#x2062;</span><span class="uname">&lt;!--invisible times--&gt;</span>&lt;/mo&gt;
    &lt;mrow id="E.3"&gt;
      &lt;mo id="E.3.1"&gt;(&lt;/mo&gt;
      &lt;mi id="E.3.2"&gt;c&lt;/mi&gt;
      &lt;mo id="E.3.3"&gt;+&lt;/mo&gt;
      &lt;mi id="E.3.4"&gt;d&lt;/mi&gt;
      &lt;mo id="E.3.5"&gt;)&lt;/mo&gt;
    &lt;/mrow&gt;
  &lt;/mrow&gt;

  &lt;annotation-xml encoding="MathML-Content"&gt;
    &lt;apply xref="E"&gt;
      &lt;and xref="E.2"/&gt;
      &lt;apply xref="E.1"&gt;
        &lt;xor xref="E.1.3"/&gt;&lt;ci xref="E.1.2"&gt;a&lt;/ci&gt;&lt;ci xref="E.1.4"&gt;b&lt;/ci&gt;
      &lt;/apply&gt;
      &lt;apply xref="E.3"&gt;
        &lt;xor xref="E.3.3"/&gt;&lt;ci xref="E.3.2"&gt;c&lt;/ci&gt;&lt;ci xref="E.3.4"&gt;d&lt;/ci&gt;
      &lt;/apply&gt;
    &lt;/apply&gt;
  &lt;/annotation-xml&gt;
&lt;/semantics&gt;
</pre>
               <p>
                  An <code>id</code> attribute and associated <code>xref</code> attributes
                  that appear within the same <code>semantics</code> element establish the
                  cross-references between corresponding sub-expressions.
                  </p>
               <p>
                  For parallel markup, all of the <code>id</code> attributes referenced by any <code>xref</code>
                  attribute should be in the <em>same</em> branch of an enclosing
                  <code>semantics</code> element.  This constraint guarantees that the
                  cross-references do not create unintentional cycles.  This restriction
                  does <em>not</em> exclude the use of <code>id</code> attributes within
                  other branches of the enclosing <code>semantics</code> element.  It does,
                  however, exclude references to these other <code>id</code> attributes
                  originating from the same <code>semantics</code> element.
                  </p>
               <p>
                  There is no restriction on which branch of the <code>semantics</code> element
                  may contain the destination <code>id</code> attributes.  It is up to the
                  application to determine which branch to use.
                  </p>
               <p>
                  In general, there will not be a one-to-one correspondence between nodes
                  in parallel branches.  For example, a presentation tree may contain elements,
                  such as parentheses, that have no correspondents in the content tree.  It is
                  therefore often useful to put the <code>id</code> attributes on the branch with
                  the finest-grained node structure.  Then all of the other branches will have
                  <code>xref</code> attributes to some subset of the <code>id</code> attributes.
                  </p>
               <p>
                  In absence of other criteria, the first branch of the <code>semantics</code>
                  element is a sensible choice to contain the <code>id</code> attributes.
                  Applications that add or remove annotations will then not have to re-assign
                  these attributes as the annotations change.
                  </p>
               <p>
                  In general, the use of <code>id</code> and <code>xref</code> attributes allows
                  a full correspondence between sub-expressions to be given in text that is
                  at most a constant factor larger than the original.  The direction of the
                  references should not be taken to imply that sub-expression selection is
                  intended to be permitted only on one child of the <code>semantics</code> element.
                  It is equally feasible to select a subtree in any branch and
                  to recover the corresponding subtrees of the other branches.
                  </p>
               <p>
                  Parallel markup with cross-references may be used in any XML-encoded branch
                  of the semantic annotations, as shown by the following example where
                  the Boolean expression of the previous section is
                  annotated with OpenMath markup that includes cross-references:
                  </p>
               <pre class="mathml">
&lt;semantics&gt;
  &lt;mrow id="EE"&gt;
    &lt;mrow id="EE.1"&gt;
      &lt;mo id="EE.1.1"&gt;(&lt;/mo&gt;
      &lt;mi id="EE.1.2"&gt;a&lt;/mi&gt;
      &lt;mo id="EE.1.3"&gt;+&lt;/mo&gt;
      &lt;mi id="EE.1.4"&gt;b&lt;/mi&gt;
      &lt;mo id="EE.1.5"&gt;)&lt;/mo&gt;
    &lt;/mrow&gt;
    &lt;mo id="EE.2"&gt;<span title="InvisibleTimes">&amp;#x2062;</span><span class="uname">&lt;!--invisible times--&gt;</span>&lt;/mo&gt;
    &lt;mrow id="EE.3"&gt;
      &lt;mo id="EE.3.1"&gt;(&lt;/mo&gt;
      &lt;mi id="EE.3.2"&gt;c&lt;/mi&gt;
      &lt;mo id="EE.3.3"&gt;+&lt;/mo&gt;
      &lt;mi id="EE.3.4"&gt;d&lt;/mi&gt;
      &lt;mo id="EE.3.5"&gt;)&lt;/mo&gt;
    &lt;/mrow&gt;
  &lt;/mrow&gt;

  &lt;annotation-xml encoding="MathML-Content"&gt;
    &lt;apply xref="EE"&gt;
      &lt;and xref="EE.2"/&gt;
      &lt;apply xref="EE.1"&gt;
        &lt;xor xref="EE.1.3"/&gt;&lt;ci xref="EE.1.2"&gt;a&lt;/ci&gt;&lt;ci xref="EE.1.4"&gt;b&lt;/ci&gt;
      &lt;/apply&gt;
      &lt;apply xref="EE.3"&gt;
        &lt;xor xref="EE.3.3"/&gt;&lt;ci xref="EE.3.2"&gt;c&lt;/ci&gt;&lt;ci xref="EE.3.4"&gt;d&lt;/ci&gt;
      &lt;/apply&gt;
    &lt;/apply&gt;
  &lt;/annotation-xml&gt;

  &lt;annotation-xml encoding="application/openmath+xml"&gt;
    &lt;om:OMA xmlns:om="http://www.openmath.org/OpenMath" href="EE"&gt;
      &lt;om:OMS name="and" cd="logic1" href="EE.2"/&gt;

      &lt;om:OMA href="EE.1"&gt;
        &lt;om:OMS name="xor" cd="logic1" href="EE.1.3"/&gt;
        &lt;om:OMV name="a" href="EE.1.2"/&gt;
        &lt;om:OMV name="b" href="EE.1.4"/&gt;
      &lt;/om:OMA&gt;

      &lt;om:OMA href="EE.3"&gt;
        &lt;om:OMS name="xor" cd="logic1" href="EE.3.3"/&gt;
        &lt;om:OMV name="c" href="EE.3.2"/&gt;
        &lt;om:OMV name="d" href="EE.3.4"/&gt;
      &lt;/om:OMA&gt;
    &lt;/om:OMA&gt;
  &lt;/annotation-xml&gt;
&lt;/semantics&gt;
</pre>
               <p>
                  Here <code>OMA</code>, <code>OMS</code>
                  and <code>OMV</code> are elements defined in the OpenMath
                  standard for representing application, symbol, and variable, respectively. 
                  The references from the OpenMath annotation are given by the
                  <code>href</code> attributes.
                  <a id="html-xml3"></a>As noted above, the use of namespaces other than MathML, SVG 
                  or HTML within <code>annotation-xml</code> is not considered valid in the HTML syntax.
                  Use of colons and namespace-prefixed element names should be avoided
                  as the HTML parser will generate nodes with <em>local</em> name <code>om:OMA</code>
                  (for example), and such nodes can not be constructed by a namespace-aware XML parser.
                  </p>
            </div>
         </div>
      </div>
      <div class="minitoc">
         
         Overview: <a href="Overview.html">Mathematical Markup Language (MathML) Version 4.0</a><br>
         Previous:     4 <a href="chapter4.html">Content Markup</a><br>
         Next:     6 <a href="chapter6.html">Interactions with the Host Environment</a></div>
   </body>
</html>