<section class="appendix">
   <h2 id="parsing">Parsing MathML</h2>
   
   
   
   
   <section>
      <h3 id="parsing_wellformed">Use of MathML as Well-Formed
         XML</h3>
      
      
      <div class="issue" id="update_schema"><span class="head">DTD and W3C XML Schema</span>
         
         
         <p>DTD and W3C XML Schema need updating to MathML3</p>
         </div>
      
      
      <div class="issue" id="relax_schema"><span class="head">Relax Schema</span>
         
         
         <p>Should we add a (normative?) Relax NG schema.</p>
         
         <div class="resolution">
            <p>We make it normative</p>
         </div>
         </div>
      
      
      <p>A MathML document must be a well-formed XML document using elements in the MathML
         namespace as defined by this specification, however it is not required that the document
         refer to any specific Document Type Definition (DTD) or schema that specifies MathML.
         It
         is sometimes advantageous <em>not</em> to specify such a language definition as these
         files are large, often much larger than the MathML expression and unless they have
         been
         previously cached by the MathML application, the time taken to fetch the DTD or schema
         may
         have an appreciable effect on the processing of the MathML document.</p>
      
      
      <p>Note that if no DTD is specified with a DOCTYPE declaration, that entity
         references (for example to refer to MathML characters by name) may not be used. The
         document should be encoded in an encoding (for example UTF-8) in which all needed
         characters may be encoded as character data, or characters may be referenced using
         numeric
         character references, for example &amp;#x222B; rather than &amp;int;</p>
      
      
      <p>If a MathML fragment is parsed without a DTD, in other words as a well-formed XML
         fragment, it is the responsibility of the processing application to treat the white
         space
         characters occurring outside of token elements as not significant.</p>
      
      
      <p>However, in many circumstances, especially while producing or editing MathML, it is
         useful to use a language definition to constrain the editing process or to check the
         correctness of generated files. The following section, <a href="#parsing_usingrnc"></a>,
         discusses the RelaxNG Schema for Mathml4 [[RELAX-NG]], which forms a normative
         part of the specification. Following that, <a href="#parsing_usingxsd"></a>, and <a href="#parsing_usingdtd"></a> discuss alternative languages definition using the document type
         definitions (DTD) and the W3C XML schema language, [[XMLSchemas]], both of
         which are derived from the normative RelaxNG schema automatically.  One should note
         that
         the schema definitions of the language is currently stricter than the DTD version.
         That
         is, a schema validating processor will declare invalid documents that are declared
         valid
         by a (DTD) validating XML parser. This is partly due to the fact that the XML schema
         language may express additional constraints not expressable in the DTD, and partly
         due to
         the fact that for reasons of compatibility with earlier releases, the DTD is intentionally
         forgiving in some places and does not enforce constraints that are specified in the
         text
         of this specification.</p>
      </section>
   
   
   <section>
      <h3 id="parsing_usingrnc">Using the RelaxNG Schema for Mathml4</h3>
      
      
      <p>MathML documents should be validated using the RelaxNG Schema for MathML, either in
         the XML encoding (<a href="http://www.w3.org/Math/RelaxNG/mathml4/mathml4.rng">http://www.w3.org/Math/RelaxNG/mathml4/mathml4.rng</a>)
         or in compact notation (<a href="http://www.w3.org/Math/RelaxNG/mathml4/mathml4.rnc">http://www.w3.org/Math/RelaxNG/mathml4/mathml4.rnc</a>)
         which is also shown below.</p>
      
      
      <p>In contrast to DTDs there is no in-document method to associate a RelaxNG schema with
         a document.</p>
      
      
      
      <p>We provide five RelaxNG schema for Mathml4 in five parts:
         </p>
      <ul>
         
         <li>
            <p>The grammar for full MathML</p>
         </li>
         
         <li>
            <p>The grammar for elements common to Content and Presentation</p>
         </li>
         
         <li>
            <p>The grammar for Presentation MathML</p>
         </li>
         
         <li>
            <p>The grammar for Strict Content MathML</p>
         </li>
         
         <li>
            <p>The grammar for Content Mathml4</p>
         </li>
         </ul>
      
      
      <section>
         <h4 id="parsing_rnc_full">Full MathML</h4>
         
         
         
         <p>The RelaxNG schema for full MathML builds on the schema describing the various parts
            of the language which are given in the following sections. It can be found at <a href="http://www.w3.org/Math/RelaxNG/mathml4/mathml4.rnc">http://www.w3.org/Math/RelaxNG/mathml4/mathml4.rnc</a>.</p>
         
         <pre></pre>
         </section>
      
      
      <section>
         <h4 id="parsing_rnc_common">Elements Common to Presentation and Content MathML</h4>
         
         
         
         <pre></pre>
         </section>
      
      
      
      <section>
         <h4 id="parsing_rnc_pres">The Grammar for Presentation MathML</h4>
         
         
         
         <pre></pre>
         
         </section>
      
      
      <section>
         <h4 id="parsing_rnc_strict">The Grammar for Strict Content Mathml4</h4>
         
         
         
         <p>The grammar for Strict Content Mathml4 can be found at <a href="http://www.w3.org/Math/RelaxNG/mathml4/mathml4-strict-content.rnc">http://www.w3.org/Math/RelaxNG/mathml4/mathml4-strict-content.rnc</a>.</p>
         
         <pre></pre>
         </section>
      
      
      
      <section>
         <h4 id="parsing_rnc_content">The Grammar for Content MathML</h4>
         
         
         
         <p>The grammar for Content Mathml4 builds on the grammar for the Strict Content MathML
            subset, and can be found at <a href="http://www.w3.org/Math/RelaxNG/mathml4/mathml4-content.rnc">http://www.w3.org/Math/RelaxNG/mathml4/mathml4-content.rnc</a>.</p>
         
         <pre></pre>
         
         </section>
      
      
      <section>
         <h4 id="parsing_rnc_module">MathML as a module in a RelaxNG Schema</h4>
         
         
         <p>Normally, a MathML expression does not constitute an entire XML document. MathML is
            designed to be used as the mathematics fragment of larger markup languages. In
            particular it is designed to be used as a <em>module</em> in documents marked up
            with the XHTML family of markup languages. As RelaxNG directly supports modular
            development, this is usually very easy: an XHTML+MathML schema can be specified as
            simply as
            
            <pre># A RelaxNG Schema for  XHTML+MathML
include "xhtml.rnc"
math = external "mathml4.rnc"
Inline.class |= math
Block.class |= math</pre>
            
            assuming that we have access to a modular RelaxNG schema for XHTML that uses
            <code>Inline.class</code> and <code>Block.class</code> to collect the the content models
            for inline and block-level elements.</p>
         
         
         <p>Customizing the Mathml4 schema so that we can restrict the content of
            <code class="element">annotation-xml</code> elements is similarly simple, for example:
            
            
            <pre># A RelaxNG Schema for MathML with OpenMath3 annotations
omobj = external "openmath3.rnc" 
include "mathml4.rnc" {anotation-xml.model = omobj}</pre>
            </p>
         
         <p>
            The Mathml4 schema is organized so that subsetting to one of the sublanguages specified
            here is easy.
            To include strict content Mathml4 in a schema just include
            
            <pre>include "mathml4-common.rnc"
include "mathml4-strict-content.rnc"</pre>
            instead of <code>include mathml4.rnc</code>.
            </p>
         
         
         <p>For details about RelaxNG grammars and modularization see [[RELAX-NG]] or [[RelaxNGBook]].</p>
         
         </section>
      </section>
   
   
   <section>
      <h3 id="parsing_usingdtd">Using the MathML DTD</h3>
      
      
      
      
      <section>
         <h4 id="interf_validation">Document Validation Issues</h4>
         
         
         <p>The use of namespace prefixes creates an issue for DTD validation
            of documents embedding MathML.  DTD validation requires knowing the
            literal (possibly prefixed) element names used in the document.
            However, the Namespaces in XML Recommendation [[Namespaces]] allows the prefix to be changed at arbitrary points
            in the document, since namespace prefixes may be declared on any
            element.</p>
         
         
         
         <p>The MathML DTD uses the strategy outlined in [[Modularization]]
            of making every element
            name in the DTD be accessed by an entity reference. This means that by
            declaring a couple of entities to specify the prefix before the DTD is
            loaded, the prefix can be chosen by a document author, and compound
            DTDs that include several modules can, without changing the module
            DTDs, specify unique prefixes for each module to avoid clashes.</p>
         
         </section>
      
      
      <section>
         <h4>Attribute values in the MathML DTD</h4>
         
         
         
         
         <p>Note that the DTD is far more permissive than the Relax NG schema, many constraints
            on attribute values may not be enforced using DTD syntax.
            For example, many attributes expect numerical values or specific micro-syntax, but
            are declared as CDATA (arbitrary string) in the DTD.
            However, lack of enforcement of a requirement in the DTD
            does <em>not</em> imply that the requirement is not part of the MathML
            language itself, or that it will not be enforced by a particular MathML
            renderer. (See <a href="#interf_error"></a> for a description of how
            MathML renderers should respond to MathML errors.)</p>
         
         
         <p>Furthermore, the MathML DTD is provided for convenience; although it is
            intended to be fully compatible with the text of the specification, the
            text should be taken as definitive if there is a contradiction.  (Any
            contradictions which may exist between various chapters of the text should
            be resolved by favoring <a href="#chars"></a> first, then <a href="#presm"></a>, <a href="#contm"></a>, then <a href="#fund_syntax"></a>,
            and then other parts of the text.)</p>
         
         </section>
      
      
      
      
      <section>
         <h4 id="parsing_doctype">DOCTYPE declaration for MathML</h4>
         
         <p>MathML documents should be validated using the XML DTD for
            MathML,
            <a href="http://www.w3.org/Math/DTD/mathml4/mathml4.dtd">http://www.w3.org/Math/DTD/mathml4/mathml4.dtd</a>.
            </p> 
         
         
         <p>Documents using this DTD should contain a DOCTYPE declaration
            of the form:
            
            <pre>&lt;!DOCTYPE math 
    PUBLIC "-//W3C//DTD MathML 3.0//EN"
           "http://www.w3.org/Math/DTD/mathml4/mathml4.dtd"&gt;</pre>
            The URI may be changed to that of a local copy
            of the DTD if required.</p>
         </section>
      
      </section>
   
   
   <section>
      <h3 id="parsing_usingxsd">Using the MathML XML Schema</h3>
      
      
      
      
      <p>MathML fragments can be validated using the XML Schema for MathML,
         located at <a href="http://www.w3.org/Math/XMLSchema/mathml4/mathml4.xsd">http://www.w3.org/Math/XMLSchema/mathml4/mathml4.xsd</a>. The
         provided schema  has been mechanically generated from the Relax NG schema, it omits
         some constraints that can not be enforced using XSD syntax.</p>
      
      
      
      <section>
         <h4 id="parsing_schemalocation">Associating the MathML schema with MathML fragments</h4>
         
         
         
         <p>Similarly to the DOCTYPE declaration used in documents, it is possible to link a MathML
            fragment to the XML Schema, as shown below.</p>
         
         
         <pre class="mathml-fragment">&lt;mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML"
          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          xsi:schemaLocation="http://www.w3.org/1998/Math/MathML
            http://www.w3.org/Math/XMLSchema/mathml4/mathml4.xsd"&gt;
...
&lt;/mml:math&gt;</pre>
         
         
         <p>The <code class="attribute">xsi:schemaLocation</code> attribute belongs to the XML Schema
            instance namespace, defined in [[XMLSchemas]].  The value
            of the attribute is a pair of URIs: the first is the MathML namespace
            URI and the second is the location of the schema for that
            namespace. The second URI may be changed to that of a local copy if
            required.</p>
         
         
         <p>As the XML Schema specification indicates, the use of the
            <code class="attribute">schemaLocation</code> attribute is only a hint for schema
            processors: validation by a MathML-aware processor can be performed
            without requiring that the <code class="attribute">schemaLocation</code> attribute be
            declared in the instance. Moreover, a processor can even ignore or
            override the specified schema URI, if it is directed to.</p>
         </section>
      
      
      </section>
   
   
   <section>
      <h3 id="parsing_mml_xhtml">Parsing MathML in XHTML</h3>
      
      
      <p>As noted in <a href="#interf_xhtml"></a> The schema used for
         XHTML+MathML documents extends the content model of <code class="element">mtext</code> to
         allow inline (phrasing) html elements. The extension used by the W3C
         validator uses the RelaxNG schema, however DTD and XSD versions of the
         grammar may be similarly extended.</p>
      </section>
   
   
   <section>
      <h3 id="parsing_mml_html">Parsing MathML in HTML</h3>
      
      
      <p>See <a href="#interf_html"></a> for more details of the parsing of MathML in HTML.</p>
      </section>
   </section>